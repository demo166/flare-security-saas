<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Flare Security Admin Dashboard</title>
    <style>
        body { display: flex; margin: 0; font-family: 'Segoe UI', sans-serif; height: 100vh; background: #f0f2f5; }
        #sidebar { width: 260px; background: #1a2a3a; color: white; padding: 20px; }
        #main { flex-grow: 1; padding: 40px; }
        .nav-link { padding: 15px; cursor: pointer; border-radius: 5px; margin-bottom: 5px; transition: 0.3s; }
        .nav-link:hover { background: #34495e; }
        .nav-link.active { background: #3498db; }
        .card { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .hidden { display: none; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; border-bottom: 1px solid #eee; text-align: left; }
        .phishing { color: #e74c3c; font-weight: bold; }
        .safe { color: #2ecc71; font-weight: bold; }
    </style>
</head>
<body>

    <div id="sidebar">
        <h2>Flare Security</h2>
        <div id="nav-dash" class="nav-link active" onclick="showPage('dashboard')">üìß Email Dashboard</div>
        <div id="nav-int" class="nav-link" onclick="showPage('integration')">‚öôÔ∏è Email Integration</div>
        <div class="nav-link" onclick="logout()" style="margin-top: 50px; color: #ff7675;">Logout</div>
    </div>

    <div id="main">
        <div id="dashboard" class="card">
            <h1>Email Security Logs</h1>
            <table id="logTable">
                <thead><tr><th>Sender</th><th>Subject</th><th>Status</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>

        <div id="integration" class="card hidden">
            <h1>Integrations</h1>
            <p>Connect Google Workspace to start scanning emails.</p>
            <button onclick="alert('Redirecting to Google Marketplace...')">Connect Google App</button>
        </div>
    </div>

    <script>
        // 1. LIVE RENDER URL
        const API_URL = "https://flare-security-saas.onrender.com";

        function showPage(id) {
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('integration').classList.add('hidden');
            document.getElementById('nav-dash').classList.remove('active');
            document.getElementById('nav-int').classList.remove('active');
            
            document.getElementById(id).classList.remove('hidden');
            document.getElementById('nav-' + (id==='dashboard'?'dash':'int')).classList.add('active');
            if(id === 'dashboard') fetchLogs();
        }

        async function fetchLogs() {
            const token = localStorage.getItem('flare_token');
            if(!token) {
                const pass = prompt("Enter Admin Password:");
                if(pass === 'admin123') {
                    const res = await fetch(`${API_URL}/login`, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({password: 'admin123'})
                    });
                    const data = await res.json();
                    localStorage.setItem('flare_token', data.token);
                    location.reload();
                }
                return;
            }

            try {
                const res = await fetch(`${API_URL}/api/logs`, {
                    headers: {'Authorization': 'Bearer ' + token}
                });
                const logs = await res.json();
                const tbody = document.querySelector('#logTable tbody');
                tbody.innerHTML = '';
                logs.forEach(log => {
                    tbody.innerHTML += `<tr>
                        <td>${log.sender}</td>
                        <td>${log.subject}</td>
                        <td class="${log.type==='Phishing'?'phishing':'safe'}">${log.type}</td>
                    </tr>`;
                });
            } catch (e) { console.error(e); }
        }

        function logout() { localStorage.removeItem('flare_token'); location.reload(); }
        window.onload = fetchLogs;
    </script>
</body>
</html>
